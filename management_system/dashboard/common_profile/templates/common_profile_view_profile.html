{% extends "base.html" %}
{% load custom_template_filters %}
{% block extrahead %} 
<script>


function ModalToggle(t_url,t_id,t_title){
var content = '';
$.ajax({ type: "GET", 
url: t_url, 
async: false,
success : function(text)
{
    content = text;
    var modal = new Modal();
    modal.setTitle(t_title);
    modal.getContentElement().append(content);
    modal.setButtons([
    {
            label:'Сохранить',
            callback:function(){
                var msg = modal.getContentElement().find(t_id).serialize();
                $.ajax({
                    type: 'POST',
                    url: t_url,
                    data: msg,
                    success: function(data) {
                        modal.hide();
                        modal.destroy();
                        if (data == "success"){
                            OkMessage("Данные сохранены.");
                        }
                        else
                            ErrorMessage("Error");
                    },
                    error: function(xhr, str){
                        modal.hide();
                        modal.destroy();
                        ErrorWindow("Error");
                    }
                });
        }
    },
    {
        label:"Закрыть",
        callback:function(){
            modal.hide();
            modal.destroy();
        }
    }]);
    modal.show();
}
});
}
</script>
{% endblock %}
{% block content %}
<table>
	<thead>
		<tr>
			<td width=10%></td>
			<td width=25%>
				Базовая информация
    			{% if edit_perm == True %}
					<a id="userdata_edit_link" href = "#" onClick="ModalToggle("{% url 'userdata_edit' %}","#userdata_form","Базовая информация"); return false;" >Редактировать</a>
				{% endif %}
			</td>
			<td width=25%>
				Документы
    			{% if edit_perm == True %}
					<a href = "{% url 'userdata_document_wizard' %}">
						Добавить/обновить
					</a>
				{% endif %}
			</td>
		</tr>
	</thead>
	<tbody>
		<tr>
    		<td>
        		<img src="{{ base_data.avatar }}"/> 
    		</td>
   			<td>
        		<p>
					ФИО:<br>
					<b>
					{{ base_data.last_name }}
					{{ base_data.first_name }}
					{{ base_data.middle_name }}
					</b>
				</p>
        		<p>
					Телефон:<br>
					<b>
					{{ base_data.phone }}
					</b>
				</p>
    		</td>
			<td>
				<p>
					{% for each in documents %}
						{{ each }}<br>
					{% endfor %}
				</p>
			</td>
</tr>
</tbody>
</table>

<table>
	<tbody>
		{% for role,fields in additional_data.items %}
    		{% if fields %}
			<tr>
				<td width=25%>
					<p>
					{{ perms_to_language|get_item:role }}
        			{% if edit_perm == True %}
            			<a href = "{% url 'common_profile_edit' role %}">
							Редактировать
						</a>
       				{% endif %}
					</p>
				</td>
				<td width=25%></td>
				<td width=25%></td>
			</tr>
			<tr>
			{% for key, value in fields.items %}
				<td> {{ key }} : {% if value %} {{ value }} {% endif %}</td>
				{% if forloop.counter|divisibleby:"3" %}
					</tr><tr>
				{% endif %}
			{% endfor %}
   			</tr>
			{% endif %}
		{% endfor %}
	</tbody>
</table>	



{% endblock %}





